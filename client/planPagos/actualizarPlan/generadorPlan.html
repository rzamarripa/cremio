<!-- Cabecera del perfil de  alumno seleccionado -->
<div class="row" ng-show="ae.cliente.profile != undefined">
	<div class="col-sm-12">
		<div class="well well-sm">
			<div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
				<h2 class="alge-title txt-color-blueDark">
					<i class="fa fa-list fa-fw "></i>
						Actualización del Crédito
				</h2>
			</div>
			<a  ui-sref="root.clienteDetalle({objeto_id: ae.cliente._id})" class="btn txt-color-white bg-color-teal btn-sm pull-right"><i class="fa fa-user"></i> Ir a mi perfil</a>
			<div class="row">
				<div class="col-sm-12">
					<form name="formNuevoCredito" class="form-horizontal" role="form" novalidate>
				  	<div class="well">	    
					  	<div class="row">
					  		<div class="col-sm-12">
					  			<div class="alert alert-info">
					  			 <p><i class="fa-fw fa fa-info"></i> Para <strong>crear un nuevo crédito</strong> es importante que pongamos la información correcta.</p>
					  			 <p><strong>Revisar bien los datos.</strong></p>
					  			</div>
					  		</div>
					  	</div>
					    <div class="row">
						    <div class="col-sm-4" valida>
						    	<label>Tipo de crédito *</label>
						    	<select name="tipoCreditoNuevo" class="form-control" ng-model="ae.credito.tipoCredito_id" required="">
							    	<option value="{{tipoCredito._id}}" ng-repeat="tipoCredito in ae.tiposCredito">{{tipoCredito.nombre}}</option>
						    	</select>
					    	</div>
					    	<div class="col-sm-4" valida>
							    <label>Tasa %*</label>
						    	<input name="tasa" type="number" class="form-control" ng-model="ae.credito.tasa" required>
						    </div>
					    	<div class="col-sm-4" valida>
						    	<label>Periodo de pago *</label>
						    	<select name="periodoCreditoNuevo" class="form-control" ng-model="ae.credito.periodoPago" required="">
							    	<option value="Semanal">Semanal</option>
							    	<option value="Quincenal">Quincenal</option>
							    	<option value="Mensual">Mensual</option>
						    	</select>
					    	</div>									    	
					    </div>
					    <div class="row">
						    <div class="col-sm-3" valida>					    
						    	<label>Duración (Meses) *</label>
						    	<input name="duracionMesesCreditoNuevo" type="number" class="form-control" placeholder="Duración en Meses" ng-model="ae.credito.duracionMeses" required="">
					    	</div>
					    	<div class="col-sm-3" valida>
						    	<label>Capital Solicitado *</label>
						    	<input name="capitalSolicitadoCreditoNuevo" type="number" class="form-control" placeholder="Capital Solicitado" ng-model="ae.credito.capitalSolicitado" required="">
					    	</div>
					    	<div class="col-sm-3">					    
						    	<label>Con Seguro</label>
						    	<input name="conSeguro" type="checkbox" class="form-control" ng-model="ae.credito.conSeguro">
					    	</div>	
					    	<div class="col-sm-3" ng-if="ae.credito.conSeguro" valida>
							    <label>Importe seguro semanal *</label>
						    	<input name="seguro" type="number" class="form-control" placeholder="Seguro" ng-model="ae.credito.seguro"  required>
						    </div>		
					    </div>
					    <div class="row">
								<div class="col-sm-2">					    
						    	<label>Requiere Verificación</label>
						    	<input name="requiereVerificacionCreditoNuevo" type="checkbox" class="form-control" ng-model="ae.credito.requiereVerificacion">
					    	</div>
					    	<div class="col-sm-2" valida>
						    	<label>Fecha Verificación</label>
						    	<input name="fechaVerificacion" date-time format="dd-MM-yyyy" class="form-control" view="date" max-view="year" min-view="date" ng-model="ae.credito.fechaVerificacion" ng-disabled="!ae.credito.requiereVerificacion" />
					    	</div>
								<div class="col-sm-2" valida>
						    	<label>Horario</label>
						    	<select name="horario" class="form-control" ng-model="ae.credito.turno" ng-disabled="!ae.credito.requiereVerificacion">
							    	<option value="mañana">Mañana</option>
							    	<option value="tarde">Tarde</option>
						    	</select>
					    	</div>
						</div>
						</div>
						
						<h4>Avales</h4>			
						<div class="well">	    
							<div class="row">
								<div class="col-sm-6"> 
										<div ng-include=" 'client/planPagos/actualizarPlan/_buscarAval.html' "></div>
								</div>
							</div>
					    <div class="row">
					    	<div class="col-sm-4"> 					    
						    	<label>Nombre</label>
						    	<input name="nombreAval" type="text" class="form-control" placeholder="Nombre" ng-model="ae.aval.nombre" disabled="true">
					    	</div>
					    	<div class="col-sm-4"> 					    
						    	<label>Apellido Paterno</label>
						    	<input name="apellidoPaternoAval" type="text" class="form-control" placeholder="Apellido Paterno" ng-model="ae.aval.apellidoPaterno" disabled="true">
					    	</div>
					    	<div class="col-sm-4"> 					    
						    	<label>Apellido Materno</label>
						    	<input name="apellidoMaternoAval" type="text" class="form-control" placeholder="Apellido Materno" ng-model="ae.aval.apellidoMaterno" disabled="true">
					    	</div>
					    </div>
					    <div class="row">	
						    <div class="col-sm-8">					    
						    	<label>Dirección</label>
						    	<input name="direccion" type="text" class="form-control" placeholder="Dirección" ng-model="ae.aval.direccion" disabled="true">
					    	</div>
						    <div class="col-sm-4"> 					    
						    	<label>Estado Civil</label>
						    	<input name="estadoCivil" type="text" class="form-control" placeholder="Estado Civil" ng-model="ae.aval.estadoCivil" disabled="true">
					    	</div>
					    </div>
					    <div class="row">		
						    <div class="col-sm-3"> 					    
						    	<label>Ocupación</label>
						    	<input name="ocupacion" type="text" class="form-control" placeholder="Ocupación" ng-model="ae.aval.ocupacion" disabled="true">
					    	</div>
					    	<div class="col-sm-3">					    
						    	<label>Empresa</label>
						    	<input name="empresa" type="text" class="form-control" placeholder="Empresa" ng-model="ae.aval.empresa" disabled="true">
					    	</div>
					    	<div class="col-sm-3">					    
						    	<label>Puesto</label>
						    	<input name="puesto" type="text" class="form-control" placeholder="Puesto" ng-model="ae.aval.puesto" disabled="true">
					    	</div>					    	
					    	<div class="col-sm-3">					    
						    	<label>Tiempo Laborando</label>
						    	<input name="tiempoLaborando" type="text" class="form-control" placeholder="Tiempo Laborando" ng-model="ae.aval.tiempoLaborando" disabled="true">
					    	</div>
					    </div>
					    <div class="row">	
						    <div class="col-sm-5">					    
						    	<label>Dirección Empresa</label>
						    	<input name="direccionEmpresa" type="text" class="form-control" placeholder="Dirección Empresa" ng-model="ae.aval.direccionEmpresa" disabled="true">
					    	</div>
					    	<div class="col-sm-3">					    
						    	<label>Parentezco</label>
						    	<input name="parentesco" type="text" class="form-control" placeholder="Parentezco" ng-model="ae.aval.parentesco" CAPITALIZE>
					    	</div>
					    	<div class="col-sm-3">					    
						    	<label>Tiempo de Conocerlo</label>
						    	<input name="tiempoConocerlo" type="text" class="form-control" placeholder="Tiempo en Conocerlo" ng-model="ae.aval.tiempoConocerlo" CAPITALIZE>
					    	</div>
					    	<!--<input type="hidden" name="aval_id" ng-model="ae.aval._id" value="">-->
					    </div>
					    <div class="row">		
					    	<div class="col-sm-3">
							   	<input type="button" ng-click="ae.insertarAval()" value="Agregar" ng-show="ae.actionAval" class="btn btn-primary"> 	
							   	<input type="button" ng-click="ae.borrarReferencia()" value="Quitar Aval" ng-show="ae.aval._id" class="btn btn-warning">
							   	<input type="button" ng-click="ae.actualizarAval(ae.aval)" value="Actualizar" ng-show="!ae.actionAval" class="btn btn-primary">
							   	<input type="button" ng-click="ae.cancelarAval()" value="Cancelar" ng-show="!ae.actionAval" class="btn btn-danger">	   				
								</div>
					    </div>
					    <br/>
					    <div class="row">
								<div class="col-sm-12">
									<table class="table table-bordered">
										<thead>
											<tr>
												<th width="5%">Número</th>
												<th width="15%">Nombre</th>
												<th width="5%">Estado Civil</th>
												<th width="5%">Ocupación</th>
												<th width="15%">Dirección</th>
												<th width="10%">Empresa</th>
												<th width="5%">Puesto</th>
												<th width="5%">Tiempo Laborando</th>
												<th width="15%">Dirección Empresa</th>
												<th width="10%">Parentesco</th>
												<th width="10%">Tiempo Conocerlo</th>
												<th width="5%">Quitar</th>
											</tr>
										</thead>
										<tbody>
											<tr ng-repeat="aval in ae.avales">
												<td>{{aval.num}}</td>
												<td>{{aval.nombre}}</td>
												<td>{{aval.estadoCivil}}</td>
												<td>{{aval.ocupacion}}</td>
												<td>{{aval.direccion}}</td>
												<td>{{aval.empresa}}</td>
												<td>{{aval.puesto}}</td>
												<td>{{aval.tiempoLaborando}}</td>
												<td>{{aval.direccionEmpresa}}</td>
												<td>{{aval.parentesco}}</td>
												<td>{{aval.tiempoConocerlo}}</td>
												<td>
														<a href="#" ng-click="ae.quitarAval(aval.num)"><i class="fa fa-trash"></i></a>
														<a href="#" ng-click="ae.editarAval(aval)"><i class="fa fa-pencil"></i></a>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						
												
						<h4>Garantias</h4>
						<div class="well">	    
							<div class="row">
								<div class="col-sm-4" valida>
							    	<label>Tipo de garantía</label>
							    	<select name="horario" class="form-control" ng-model="ae.credito.tipoGarantia">
								    	<option value="general">General o inmobiliaria</option>
								    	<option value="mobiliaria">Mobiliaria</option>
							    	</select>
						    </div>
							</div>
							
							
							
							<div  ng-if="ae.credito.tipoGarantia == 'mobiliaria'">
								
								<div class="row">
									<div class="col-sm-4">
									<!-- 	<div class="checkbox"> 					    
								    	<label><input name="esVehiculo" type="checkbox" ng-model="ae.garantia.esVehiculo">Es Vehículo</label>
							    	</div> -->
									</div>
								</div>

						    <div class="row">
						    	<div class="col-sm-4"> 					    
							    	<label>Descripción Generica</label>
							    	<input name="descripcion" type="text" class="form-control" placeholder="DESCRIPCIÓN" ng-model="ae.garantia.descripcion">
						    	</div>
						    	<div class="col-sm-4"> 					    
							    	<label>Características	</label>
							    	<input name="caracteristicas" type="text" class="form-control" placeholder="Caracteristicas" ng-model="ae.garantia.caracteristicas">
						    	</div>
						    	<div class="col-sm-4"> 					    
							    	<label>Avalúo</label>
							    	<input name="avaluo" type="number" class="form-control" placeholder="AVALÚO" ng-model="ae.garantia.avaluo">
						    	</div>
						    </div>
						    <div class="row">	
						    <div class="col-sm-4">					    
							    	<label>Préstamo </label>
							    	<input name="serie" type="number" class="form-control" placeholder="PRÉSTAMO" ng-model="ae.garantia.prestamo">
						    	</div>
							    <div class="col-sm-4">					    
							    	<label>Préstamo sobre avalúo</label>
							    	<input name="serie" type="number" class="form-control" placeholder="PRÉSTAMO SOBRE AVALÚO" ng-model="ae.garantia.prestamoPorcentaje">
						    	</div>
						    	 <div class="col-sm-4">					    
							    	<label>Monto de avalúo</label>
							    	<input name="serie" type="number" class="form-control" placeholder="MOTO DE AVALÚO" ng-model="ae.garantia.monto">
						    	</div>
						    	 <div class="col-sm-4">					    
							    	<label>Porcentaje del prestamo sobre el avalúo</label>
							    	<input name="serie" type="number" class="form-control" placeholder="PORCENTAJE DEL PRESTAMO SOBRE AVALÚO" ng-model="ae.garantia.porcentaje">
						    	</div>
						    	<div class="col-sm-4">					    
							    	<label>Fecha de inico de comercialización</label>
							    	<input name="serie" class="form-control" placeholder="FECHA DE INICIO DE COMERCIALIZACIÓN" ng-model="ae.garantia.fechaComercializacion" date-time format="dd-MM-yyyy" view="date" max-view="year" min-view="date">
						    	</div>
						    	
						    	<div class="col-sm-4">					    
							    	<label>Fecha limite de finquito</label>
							    	<input name="serie"  class="form-control" placeholder="FECHA LIMITE DE FINIQUITO" ng-model="ae.garantia.fechaFiniquito" date-time format="dd-MM-yyyy" view="date" max-view="year" min-view="date">
						    	</div>
						    </div>
						    <div class="row">		<br/>
						    	<div class="col-sm-3">
								   	<input type="button" ng-click="ae.insertarGarantia(ae.credito.tipoGarantia)" value="Agregar" ng-show="ae.actionGarantia" class="btn btn-primary"> 	
								   	<input type="button" ng-click="ae.actualizarGarantia(ae.credito.tipoGarantia, ae.garantia)" value="Actualizar" ng-show="!ae.actionGarantia" class="btn btn-primary">
								   	<input type="button" ng-click="ae.cancelarGarantia(ae.credito.tipoGarantia)" value="Cancelar" ng-show="!ae.actionGarantia" class="btn btn-danger">	   				
									</div>
						    </div>
						    <br/>
						    <div class="row">
									<div class="col-sm-12">
										<table class="table table-bordered">
											<thead>
																			<!-- DESCRIPCIÓN GENÉRICA	CARACTERÍSTICAS	AVALÚO	PRÉSTAMO	% PRESTAMO SOBRE AVALÚO -->
																	<!-- 		MONTO DEL AVALÚO $	PORCENTAJE DEL PRÉSTAMO SOBRE EL AVALÚO: %
FECHA DE INICIO DE COMERCIALIZACIÓN	FECHA LÍMITE DE FINIQUITO -->


												<tr>
													<th width="5%">Número</th>
													<th width="15%">Descripción genérica</th>
													<th width="15%">Características</th>
													<th width="15%">Avalúo</th>
													<th width="15%">Préstamo</th>
													<th width="15%">Préstamo sobre avalúo</th>
													<th width="15%">Monto del avalúo</th>
													<th width="15%">Porcentaje del préstamo sobre el avalúo</th>
													<th width="15%">Fecha de inicio de comercialización</th>
													<th width="15%">Fecha limite de finiquito</th>
													<th width="5%">Acción</th>
												</tr>
											</thead>
											<tbody>
												<tr ng-repeat="garantia in ae.garantias">
													<td>{{garantia.num}}</td>
													<td>{{garantia.descripcion}}</td>
													<td>{{garantia.caracteristicas}}</td>
													<td>{{garantia.avaluo}}</td>
													<td>{{garantia.prestamo}}</td>
													<td>{{garantia.prestamoPorcentaje}}</td>
													<td>{{garantia.monto}}</td>
													<td>{{garantia.porcentaje}}</td>
													<td>{{garantia.fechaComercializacion | date:"dd-MM-yyyy"}}</td>
													<td>{{garantia.fechaFiniquito | date:"dd-MM-yyyy"}}</td>
													<td>
															<a href="#" ng-click="ae.quitarGarantia(ae.credito.tipoGarantia, garantia.num)"><i class="fa fa-trash"></i></a>
															<a href="#" ng-click="ae.editarGarantia(ae.credito.tipoGarantia, garantia)"><i class="fa fa-pencil"></i></a>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
							
							<div  ng-if="ae.credito.tipoGarantia == 'general'">
								<div class="row">
							    	<div class="col-sm-6"> 					    
											  <label>Descripción:</label>
											  <textarea class="form-control" rows="5"  cols="10" ng-model="ae.garantia.descripcion" name="descripcion"></textarea>
							    	</div>
							    	<div class="col-sm-4"> 					    
								    	<label>Valor estimado:</label>
								    	<input name="valorEstimado" type="text" class="form-control" placeholder="Valor Estimado" ng-model="ae.garantia.valorEstimado">
							    	</div>
								</div>
								<div class="row">
									<div class="col-sm-12">
										<table class="table table-bordered">
											<thead>
												<tr>
													<th width="5%">Número</th>
													<th width="15%">Descripción</th>
													<th width="15%">Valor estimado</th>
													<th width="5%">Acción</th>
												</tr>
											</thead>
											<tbody>
												<tr ng-repeat="garantia in ae.garantiasGeneral">
													<td>{{garantia.num}}</td>
													<td>{{garantia.descripcion}}</td>
													<td>{{garantia.valorEstimado}}</td>
													<td>
															<a href="#" ng-click="ae.quitarGarantia(ae.credito.tipoGarantia, garantia.num)"><i class="fa fa-trash"></i></a>
															<a href="#" ng-click="ae.editarGarantia(ae.credito.tipoGarantia, garantia)"><i class="fa fa-pencil"></i></a>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
								<div class="row">		
						    	<div class="col-sm-3">
								   	<input type="button" ng-click="ae.insertarGarantia(ae.credito.tipoGarantia)" value="Agregar" ng-show="ae.actionGarantia" class="btn btn-primary"> 	
								   	<input type="button" ng-click="ae.actualizarGarantia(ae.credito.tipoGarantia, ae.garantia)" value="Actualizar" ng-show="!ae.actionGarantia" class="btn btn-primary">
								   	<input type="button" ng-click="ae.cancelarGarantia(ae.credito.tipoGarantia)" value="Cancelar" ng-show="!ae.actionGarantia" class="btn btn-danger">	   				
									</div>
						    </div>
								
							</div>		 
						
						
						
						</div> <!--Fin del wel-->
						<div class="row">
							<div class="col-sm-12">
								<button class="btn btn-success" ng-click="ae.actualizarCredito()" valida-form formulario="formNuevoCredito">Actualizar Solicitud de Crédito</button>
							</div>
						</div>	  
				  </form>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-sm-12" >
		<button class="btn btn-info" ng-click="ae.generarPlanPagos(ae.credito, formNuevoCredito)" valida-form formulario="formNuevoCredito">Calcular Plan de Pagos</button>
		<table class="table table-striped table-bordered table-condensed font-xs">
			<caption>
				<h4>Plan Nuevo</h4>
			</caption>
			<thead class="thead">
				<tr>
					<th class="text-center" width="5%">No.</th>
					<th class="text-center" width="20%">Fecha de Pago</th>
					<th class="text-center" width="15%">Pago</th>
					<th class="text-center" width="10%">Capital</th>
					<th class="text-center" width="10%">Interes</th>
					<th class="text-center" width="10%">IVA</th>
					<th class="text-center" width="10%">Seguro</th>
					<th class="text-center" width="10%">Importe total</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-class="( pago.estatus == 1 ) ? 'success' : ( pago.fecha < ae.fechaActual && pago.estatus == 0 ) ? 'warning' : ( pago.estatus == 2 ) ? 'danger' : 'info'" ng-repeat="pago in ae.planPagos">
					<td class="text-center">{{$index + 1}}</td>	
					<td class="text-center">{{pago.fechaLimite | date:"dd-MM-yyyy HH:mm:ss"}}</td>
					<td class="text-center">{{pago.numeroPago}} - {{ae.planPagos.length}}</td>
					<td class="text-right">{{pago.capital | currency}}</td>
					<td class="text-right">{{pago.interes | currency}}</td>
					<td class="text-right">{{pago.iva | currency}}</td>
					<td class="text-right">{{pago.seguro | currency}}</td>
					<td class="text-right">{{pago.importeRegular | currency}}</td>
				</tr>
			</tbody>
		</table>	
	</div>
</div>


