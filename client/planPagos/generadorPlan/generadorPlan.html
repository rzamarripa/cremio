<div class="row">
	<div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
		<h1 class="alge-title txt-color-blueDark">
			<i class="fa fa-list fa-fw "></i>
				Alumnos &gt; Buscar
		</h1>
	</div>
</div>
<br>
<!-- Cabecera del perfil de  alumno seleccionado -->
<div class="row" ng-show="ge.cliente.profile != undefined">
	<div class="col-sm-12">
		<div class="well well-sm">
			<div class="row">
				<div class="col-sm-12 col-md-12 col-lg-12">
					<div class="well well-light well-sm no-margin no-padding">
						<div class="row">
							<div class="col-sm-12">
								<div id="myCarousel" class="carousel profile-carousel">
									<div class="air air-bottom-right padding-10">
										<a ng-if="currentUser.roles[0] == 'Gerente' || currentUser.roles[0] == 'Ventanilla'" ui-sref="root.clienteDetalle({objeto_id : ge.cliente._id})" class="btn txt-color-white bg-color-teal btn-sm"><i class="fa fa-user"></i> Ir a mi perfil</a>&nbsp;
 										<a ui-sref="root.editarCliente({cliente_id : ge.cliente._id})" class="btn txt-color-white bg-color-pinkDark btn-sm" ng-show="currentUser.roles[0] == 'Gerente'">
	 										<i class="fa fa-pencil"></i> Modificar
	 									</a> 
									</div>
									<div class="air air-top-left padding-10">
										<h4 class="txt-color-white font-md"><i class="fa fa-calendar"></i>&nbsp;&nbsp;{{ge.fechaActual | date:'dd-MM-yyyy'}}</h4>
									</div>
									<ol class="carousel-indicators">
									</ol>
									<div class="carousel-inner">
										<div class="item active">
											<img src="img/demo/s1.jpg" alt="" style="width:100%">
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-12">
								<div class="row">
									<div class="col-sm-2 profile-pic" style="text-align:left;width:initial;">
										<img style="max-width:200px;" src="{{ge.tieneFoto(ge.cliente.profile.sexo, ge.cliente.profile.fotografia)}}" >
									</div>
									<div class="col-sm-6">
										<h1>{{ge.cliente.profile.nombre}} <span class="semi-bold">{{ge.cliente.profile.apellidoPaterno}} {{ge.cliente.profile.apellidoMaterno}}</span>
										
										<small> (Alumno)</small></h1>
										<ul class="list-unstyled">
											<li>
												<p class="text-muted">
													<i class="fa fa-key fa-lg"></i>&nbsp;&nbsp;
													<span class="txt-color-darken">
														<strong>{{ge.pago.username}}</strong>
													</span>
												</p>
											</li>
											<li>
												<p class="text-muted">
													<i class="fa fa-phone fa-lg"></i>&nbsp;&nbsp;<span class="txt-color-darken">{{ge.cliente.profile.telefono}}</span>
												</p>
											</li>
											<li>
												<p class="text-muted">
													<i class="fa fa-envelope fa-lg"></i>&nbsp;&nbsp;<a href="mailto:{{ge.cliente.profile.correo}}">{{ge.cliente.profile.correo}}</a>
												</p>
											</li>
											<li>
												<p class="text-muted">
													<i class="fa fa-birthday-cake fa-lg"></i>&nbsp;&nbsp;<span class="txt-color-darken">{{ge.cliente.profile.fechaNacimiento | date:"dd-MM-yyyy"}}</span>
												</p>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
						<!-- Formulario de Nuevo Crédito -->
						<div class="row">
							<div class="col-sm-12">
								<a class="btn btn-{{ge.nuevoBotonCredito == true ? 'primary' : 'danger'}}" role="button" data-toggle="collapse" 
									href="#collapseNuevoCredito" aria-expanded="false" aria-controls="collapseExample" ng-click="ge.nuevoCredito()">
								 {{ge.nuevoBotonCredito == true ? 'Generar Nuevo Crédito' : 'Cancelar'}}
								</a>
								<a class="btn btn-{{ge.nuevoBotonPago == true ? 'primary' : 'danger'}}" role="button" data-toggle="collapse" 
									href="#collapseNuevoPago" aria-expanded="false" aria-controls="collapseExample" ng-click="ge.nuevoPago()">
								 {{ge.nuevoBotonPago == true ? 'Agregar Pago' : 'Cancelar'}}
								</a>
								<a class="btn btn-{{ge.nuevoBotonReestructuracion == true ? 'primary' : 'danger'}}" role="button" data-toggle="collapse" 
									href="#collapseReestructuracion" aria-expanded="false" aria-controls="collapseExample" ng-click="ge.nuevaReestructuracion()">
								 {{ge.nuevoBotonReestructuracion == true ? 'Reestructurar Crédito' : 'Cancelar'}}
								</a>
								<div class="collapse" id="collapseNuevoCredito">
									<form name="formNuevoCredito" class="form-horizontal" role="form" novalidate>
								  	<div class="well">	    
									  	<div class="row">
									  		<div class="col-sm-12">
									  			<div class="alert alert-info">
									  			 <p><i class="fa-fw fa fa-info"></i> Para <strong>crear un nuevo crédito</strong> es importante que pongamos la información correcta.</p>
									  			 <p><strong>Revisar bien los datos.</strong></p>
									  			</div>
									  		</div>
									  	</div>
									    <div class="row">
									    	<div class="col-sm-4" valida>
										    	<label>Fecha Inicial *</label>
										    	<input date-time format="dd-MM-yyyy" class="form-control" view="date" max-view="year" min-view="date" ng-model="ge.credito.fechaInicial" name="fechaCreditoNuevo" required/>
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Total de Meses *</label>
										    	<input name="totalPagosCreditoNuevo" type="number" class="form-control" placeholder="Cantidad de Pagos" ng-model="ge.credito.totalPagos" required="">
									    	</div>
									    	<div class="col-sm-4" valida>
										    	<label>Tipo de Crédito</label>
										    	<select name="tipoCreditoNuevo" class="form-control" ng-model="ge.credito.tipoCredito_id" ng-change="ge.calcularRecargos()">
											    	<option value="{{tipoCredito._id}}" ng-repeat="tipoCredito in ge.tiposCredito">{{tipoCredito.nombre}}</option>
										    	</select>
									    	</div>
									    </div>
									    <div class="row">
									    	<div class="col-sm-4" valida>
										    	<label>Importe *</label>
										    	<input name="importeRegularCreditoNuevo" type="number" class="form-control" placeholder="Cantidad del Crédito" ng-model="ge.credito.importeRegular" required="" ng-change="ge.calcularRecargos()">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Importe Recargo *</label>
										    	<input name="importeRecargoCreditoNuevo" type="number" class="form-control" placeholder="Monto recargo" ng-model="ge.credito.importeRecargo" required="">
									    	</div>
									    </div> 
										</div>
										<div class="row">
											<div class="col-sm-12">
												<button class="btn btn-info" ng-click="ge.planPagosSemana(ge.credito, formNuevoCredito)" valida-form formulario="formNuevoCredito">Calcular Plan de Pagos</button>
											</div>
										</div>	  
								  </form>
								</div>
							</div>
						</div>
						<!-- Formulario de Nuevo Pago -->
						<div class="row"> 
							<div class="col-sm-12">
								<div class="collapse" id="collapseNuevoPago">
									<form name="form" class="form-horizontal" role="form" novalidate>
								  	<div class="well">	    
									    <div class="row">
									    	<div class="col-sm-4" valida>
													<label for="fechaPago">Fecha de Pago *</label>
													<input name="fechaPago" date-time format="dd-MM-yyyy" class="form-control" view="date" max-view="year" min-view="date" ng-model="ge.credito.fecha" required="" />
												</div>
									    	<div class="col-sm-4" valida>
										    	<label>Colegiatura *</label>
										    	<input name="clave" type="text" class="form-control" placeholder="Colegiatura" ng-model="ge.credito.semana" required="">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Año *</label>
										    	<input name="anio" type="text" class="form-control" placeholder="Año" ng-model="ge.credito.anio" required="">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Importe *</label>
										    	<input name="importe" type="number" class="form-control" ng-model="ge.credito.importe" required="">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Recargo *</label>
										    	<input name="recargo" type="number" class="form-control" ng-model="ge.credito.importeRecargo" required="">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Descuento *</label>
										    	<input name="descuento" type="number" class="form-control" ng-model="ge.credito.importeDescuento" required="">
									    	</div>
									    </div> 
									    <div class="row">
									    	<div class="col-sm-12">
											    <label>Descripción</label>
											    <textarea name="descripcion" class="form-control" placeholder="Descripción" ng-model="ge.credito.descripcion" required=""></textarea>
									    	</div>
									    </div>
										</div>
										<div class="row">
											<div class="col-sm-12">
												<input type="submit" ng-click="ge.guardar(ge.credito,form)" value="Guardar" class="btn btn-primary" ng-show="ge.action" valida-form formulario="form">
												<input type="submit" ng-click="ge.actualizar(ge.credito,form)" value="Actualizar" class="btn btn-primary" ng-show="!ge.action" valida-form formulario="form">				
											</div>
										</div>	  
								  </form>
								</div>
							</div>
						</div>
						<!-- Formulario de Reestructuracion -->
						<div class="row"> 
							<div class="col-sm-12">
								<div class="collapse" id="collapseReestructuracion">
									<form name="formMasivo" class="form-horizontal" role="form" novalidate>
								  	<div class="well">	    
									  	<div class="row">
									  		<div class="col-sm-12">
									  			<div class="alert alert-warning">
									  			 <p><i class="fa-fw fa fa-warning"></i> La <strong>actualización masiva</strong> es una herramienta que actualizará el importe, recargo y descuento en un rango de semanas dadas, por favor asegúrese de hacerlo correctamente.</p>
									  			 <p><strong>No se pueden modificar colegiaturas pagadas</strong></p>
									  			</div>
									  		</div>
									  	</div>
									    <div class="row">
									    	<div class="col-sm-4" valida>
										    	<label>Semana Inicial *</label>
										    	<input name="semanaIncialMasiva" type="number" class="form-control" placeholder="De la semana" ng-model="ge.modificacion.semanaInicial" required="">
									    	</div>
									    	<div class="col-sm-4" valida>
										    	<label>Semana Final *</label>
										    	<input name="semanaFinalMasiva" type="number" class="form-control" placeholder="A la semana" ng-model="ge.modificacion.semanaFinal" required="">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Año *</label>
										    	<input name="anioMasiva" type="number" class="form-control" placeholder="En el año" ng-model="ge.modificacion.anio" required="">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Importe *</label>
										    	<input name="importeMasivo" type="number" class="form-control" placeholder="Nuevo costo colegiatura" ng-model="ge.modificacion.importeRegular" required="">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Recargo *</label>
										    	<input name="recargoMasivo" type="number" class="form-control" placeholder="Monto recargo" ng-model="ge.modificacion.recargo" required="">
									    	</div>
									    	<div class="col-sm-4" valida>					    
										    	<label>Descuento *</label>
										    	<input name="descuentoMasivo" type="number" class="form-control" placeholder="Monto descuento" ng-model="ge.modificacion.descuento" required="">
									    	</div>
									    </div> 
									    <div class="row">
									    	<div class="col-sm-12" valida>
											    <label>Descripción</label>
											    <textarea name="descripcionMasiva" class="form-control" placeholder="Descripción" ng-model="ge.modificacion.descripcion" required=""></textarea>
									    	</div>
									    </div>
										</div>
										<div class="row">
											<div class="col-sm-12">
												<input type="submit" ng-click="ge.modificacionMasiva(ge.modificacion,formMasivo)" value="Modificar" class="btn btn-primary" valida-form formulario="formMasivo">	
											</div>
										</div>	  
								  </form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row" ng-show="ge.planPagosViejo.length > 0 || ge.planPagos.length > 0">
	<div class="col-sm-6" >
		<div class="row" ng-show="ge.planPagos.length > 0">
			<div class="col-sm-12">
				<table class="table table-striped table-bordered table-condensed font-xs">
					<caption>
						<h4>Plan Nuevo</h4>
					</caption>
					<thead class="thead">
						<tr>
							<th class="text-center" width="5%">No.</th>
							<th class="text-center" width="20%">Fecha de Pago</th>
							<th class="text-center" width="15%">Pago</th>
							<th class="text-center" width="10%">Importe</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-class="(pago.estatus == 1) ? 'success' : (pago.fecha < ge.fechaActual && pago.estatus == 0) ? 'warning' : (pago.estatus == 2) ? 'danger' : 'info'" ng-repeat="pago in ge.planPagos">
							<td class="text-center">{{$index + 1}}</td>	
							<td class="text-center">{{pago.fechaLimite | date:"dd-MM-yyyy"}}</td>
							<td class="text-center">{{pago.numeroPago}} - {{ge.planPagos.length}}</td>
							<td class="text-right">{{pago.importeRegular | currency}}</td>
						</tr>
					</tbody>
				</table>	
				<button class="btn btn-success" ng-click="ge.generarCredito()">Generar Crédito</button>							
			</div>
		</div>
	</div>
	
	<!-- 	<div class="col-sm-12"> 
		<a class="btn btn-{{ge.checkPagar == true ? 'primary' : 'danger'}}" ng-click="ge.mostrarPagar()"> {{ge.checkPagar == true ? 'Seleccionar pago' : 'Ocultar'}}</a>
		</div> -->
	
	<div class="col-sm-{{(ge.nuevoBotonReestructuracion == true) ? 12 : 6}}">
		<div class="row" ng-show="ge.planPagosViejo.length > 0">
			<div class="col-sm-8">
				<table class="table table-striped table-bordered table-condensed font-xs">
					<caption>
						<h4>Plan Actual</h4>
					</caption>
					<thead class="thead">
						<tr>
							<th class="text-center" width="5%"></th>
							<th class="text-center" width="5%">No.</th>
							<th class="text-center" width="20%">Fecha de Pago</th>
							<th class="text-center" width="15%">Pago</th>
							<th class="text-center" width="10%">Importe</th>
							<th class="text-center" width="20%">Descripción</th>
							<th class="text-center" width="20%">Acciones</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-class="(pago.estatus == 1) ? 'success' : (pago.fechaLimite < ge.fechaActual && pago.estatus == 0) ? 'warning' : (pago.estatus == 2) ? 'danger' : 'info'" ng-repeat="pago in ge.planPagosViejo">

							<td ><a ng-model="pago.pagoSeleccionado" ng-click="ge.seleccionarPago(pago)" class="btn btn-xs btn-{{pago.pagoSeleccionado == true ? 'success' : 'danger'}}" ng-if="pago.estatus != 1" >{{pago.pagoSeleccionado == true ? 'Pagado' : 'Por pagar'}}</a> </td>
							<td class="text-center">{{$index + 1}}</td>	
							<td class="text-center">{{pago.fechaLimite | date:"dd-MM-yyyy"}}</td>
							<td class="text-center">{{pago.numeroPago}} - {{ge.planPagos.length}}</td>
							<td class="text-right">{{pago.importeRegular | currency}}</td>
							<td >{{pago.descripcion}}</td>
							<td class="text-center">
								<span ng-if="pago.estatus == 0">
									<button class="btn btn-warning btn-xs" ng-click="ge.editar(pago)"><i class="fa fa-pencil"></i></button>
									<button class="btn btn-danger  btn-xs" ng-click="ge.cambiarEstatus(pago, 2, 'eliminar')"><i class="fa fa-trash"></i></button>
								</span>
								<span ng-if="pago.estatus == 2">
									<button class="btn btn-success btn-xs" ng-click="ge.cambiarEstatus(pago, 0, 'activar')"><i class="fa fa-check"></i></button>
								</span>
							</td>
						</tr>
					</tbody>
				</table>	
			</div>
			<br/>
			<div class="col-sm-4">
				<h4>Total a pagar: {{ge.pago.totalPago | currency }}</h4>
				<br/>
				<caption>Monto a pagar: </caption> <input  type="number" class="form-control" placeholder="Pagar" ng-model="ge.pago.pagar">
				<br/>
				<h4>Cambio: {{  ge.pago.pagar  - ge.pago.totalPago | currency }}</h4>
				<br/>
				<a class="btn btn-primary pull-right" ng-click="ge.guardarPago(ge.pago,ge.credito)">Guardar</a>
			</div>
		</div>
	</div>
</div>


